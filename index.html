<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í•™ê¸‰ ì ìˆ˜íŒ - í•™ìƒìš©</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 20px; }
  h1, h2 { text-align: center; }
  .grade, .class-card { margin: 10px auto; padding: 10px; border-radius: 8px; background: #fff; max-width: 600px; box-shadow: 0 0 5px #ccc; }
  .grade-header { display: flex; justify-content: space-between; align-items: center; }
  .class-card { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; flex-direction: column; }
  .class-header { display: flex; justify-content: space-between; width: 100%; }
  .class-name { font-weight: bold; }
  .points { font-weight: bold; color: #ffb400; text-shadow: 0 0 2px #000; margin-left: 10px; }
  .badge { font-weight: bold; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: #fff; }
  .gold { background: gold; color: #000; }
  .silver { background: silver; color: #000; }
  .bronze { background: #cd7f32; }
  .reasons { max-height: 120px; overflow-y: auto; border-top: 1px solid #ccc; margin-top: 5px; padding-top: 5px; font-size: 0.9em; width: 100%; }
  a { text-decoration: none; color: #333; cursor: pointer; }
  #back-button { margin: 10px; display: inline-block; cursor: pointer; color: #007bff; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ===== Replace these with your Firebase project settings =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  // =============================================================

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // === GLOBAL STATE ===
  let currentGrade = null;

  // Load main grades page
  function loadGrades() {
    currentGrade = null;
    const container = document.getElementById('main-container');
    container.innerHTML = '<h1>í•™ê¸‰ ì ìˆ˜íŒ - í•™ìƒìš©</h1><div id="grades"></div>';
    const gradesDiv = document.getElementById('grades');

    for(let i=1; i<=6; i++){
      const gradeKey = `${i}í•™ë…„`;
      const gradeCard = document.createElement('div');
      gradeCard.className = 'grade';
      gradeCard.innerHTML = `<div class="grade-header"><span>${gradeKey}</span><span id="top-badges-${gradeKey}"></span></div>`;
      gradeCard.onclick = () => loadClasses(gradeKey);
      gradesDiv.appendChild(gradeCard);

      // Load top 3 for each grade
      db.ref(`TabdongStudents/${gradeKey}`).once('value').then(snapshot => {
        const classes = snapshot.val();
        if(!classes) return;
        const pointsArray = Object.values(classes).map(c => c.points || 0);
        const sortedPoints = [...new Set(pointsArray)].sort((a,b)=>b-a);
        const topPoints = [sortedPoints[0]||0, sortedPoints[1]||0, sortedPoints[2]||0];
        const badgesSpan = document.getElementById(`top-badges-${gradeKey}`);
        for(const className in classes){
          const c = classes[className];
          if(c.points === topPoints[0]) badgesSpan.innerHTML += '<span class="badge gold">ğŸ¥‡</span>';
          else if(c.points === topPoints[1]) badgesSpan.innerHTML += '<span class="badge silver">ğŸ¥ˆ</span>';
          else if(c.points === topPoints[2]) badgesSpan.innerHTML += '<span class="badge bronze">ğŸ¥‰</span>';
        }
      });
    }
  }

  // Load classes of a specific grade
  function loadClasses(gradeKey){
    currentGrade = gradeKey;
    const container = document.getElementById('main-container');
    container.innerHTML = `<h1>${gradeKey} í•™ê¸‰ ì ìˆ˜</h1><div id="back-button" onclick="loadGrades()">&larr; ë’¤ë¡œê°€ê¸°</div><div id="classes"></div>`;
    const classesContainer = document.getElementById('classes');

    db.ref(`TabdongStudents/${gradeKey}`).once('value').then(snapshot => {
      const classes = snapshot.val();
      if(!classes) {
        classesContainer.innerHTML = "<p>í•´ë‹¹ í•™ë…„ì˜ í•™ê¸‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      for(const className in classes){
        const classData = classes[className];
        const card = document.createElement('div');
        card.className = 'class-card';

        const headerDiv = document.createElement('div');
        headerDiv.className = 'class-header';
        headerDiv.innerHTML = `<span class="class-name">${className}</span> <span class="points">${classData.points || 0}ì </span>`;
        card.appendChild(headerDiv);

        // Reasons
        const reasonsDiv = document.createElement('div');
        reasonsDiv.className = 'reasons';
        if(classData.reasons){
          classData.reasons.forEach(r => {
            const p = document.createElement('p');
            p.textContent = r;
            reasonsDiv.appendChild(p);
          });
        }
        card.appendChild(reasonsDiv);
        classesContainer.appendChild(card);
      }
    }).catch(err => {
      console.error("Firebase error:", err);
      classesContainer.innerHTML += "<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
    });
  }

  window.onload = loadGrades;
</script>
</head>
<body>
<div id="main-container"></div>
</body>
</html>
