<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÌïôÍ∏â Ï†êÏàòÌåê (ÌïôÏÉùÏö©)</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", system-ui, Arial, sans-serif;
  background: linear-gradient(180deg, #eef7ff, #dbeafe);
  color: #020617;
  overflow-x: hidden;
}

/* Layout */
#home, #view {
  padding: 16px;
  max-width: 500px;
  margin: auto;
}

h1, h2 {
  text-align: center;
  font-weight: 900;
}

ul { list-style: none; padding: 0; }

li {
  background: linear-gradient(145deg, #ffffff, #edf4ff);
  border-radius: 22px;
  padding: 18px;
  margin-bottom: 16px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.08);
  animation: fadeUp 0.6s ease;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* Buttons */
.link-btn {
  width: 100%;
  background: linear-gradient(90deg, #60a5fa, #93c5fd);
  color: white;
  border: none;
  border-radius: 999px;
  padding: 16px;
  font-size: 22px;
  font-weight: 900;
  cursor: pointer;
  animation: softPulse 3s ease-in-out infinite;
}

@keyframes softPulse {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.03); }
}

.rank-line {
  margin-top: 10px;
  font-size: 16px;
  font-weight: bold;
}

.rank-1 { color: #f59e0b; }
.rank-2 { color: #64748b; }
.rank-3 { color: #92400e; }

.back-btn {
  background: none;
  border: none;
  font-size: 16px;
  color: #2563eb;
  cursor: pointer;
  margin-bottom: 8px;
}

/* Score */
.total-score {
  background: linear-gradient(135deg, #bfdbfe, #dbeafe);
  border-radius: 999px;
  padding: 18px;
  text-align: center;
  font-size: 34px;
  font-weight: 900;
  margin: 16px 0;
  animation: floatScore 4s ease-in-out infinite;
}

@keyframes floatScore {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

/* Reasons */
.reasons-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  max-height: 260px;
  overflow-y: auto;
}

.reason-card {
  background: #f8fafc;
  border-radius: 18px;
  padding: 14px;
  font-weight: bold;
  animation: popIn 0.4s ease;
}

@keyframes popIn {
  from { transform: scale(0.95); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

.reason-card.plus {
  background: #dcfce7;
  color: #065f46;
}

.reason-card.minus {
  background: #fee2e2;
  color: #7f1d1d;
}

.reason-time {
  font-size: 12px;
  font-weight: normal;
  margin-top: 4px;
  opacity: 0.7;
}

/* üéâ Confetti splash (up then fall) */
.confetti {
  position: fixed;
  bottom: -30px;
  font-size: 20px;
  pointer-events: none;
  animation: confettiSplash 4s ease-out forwards;
}

@keyframes confettiSplash {
  0%   { transform: translateY(0) rotate(0deg); opacity: 1; }
  40%  { transform: translateY(-60vh) rotate(360deg); }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* üí© Poo peek */
.poo {
  position: fixed;
  font-size: 120px;
  z-index: 999;
  pointer-events: none;
  animation-duration: 3.5s;
  animation-fill-mode: forwards;
}

/* Individual peek animations */
@keyframes peekLeft {
  0% { transform: translateX(-140px); }
  30% { transform: translateX(0); }
  70% { transform: translateX(0); }
  100% { transform: translateX(-140px); }
}

@keyframes peekRight {
  0% { transform: translateX(140px); }
  30% { transform: translateX(0); }
  70% { transform: translateX(0); }
  100% { transform: translateX(140px); }
}

@keyframes peekTop {
  0% { transform: translateY(-140px) rotate(180deg); }
  30% { transform: translateY(0) rotate(180deg); }
  70% { transform: translateY(0) rotate(180deg); }
  100% { transform: translateY(-140px) rotate(180deg); }
}

@keyframes peekBottom {
  0% { transform: translateY(140px); }
  30% { transform: translateY(0); }
  70% { transform: translateY(0); }
  100% { transform: translateY(140px); }
}
</style>
</head>

<body>

<div id="home">
  <h1>ÌïôÎÖÑ ÏÑ†ÌÉù</h1>
  <ul id="grade-links"></ul>
</div>

<div id="view"></div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAfFbHdfoXoOLw7rD-nd8HPSaZR6OBBYf8",
  authDomain: "tally-v-2.firebaseapp.com",
  databaseURL: "https://tally-v-2-default-rtdb.firebaseio.com",
  projectId: "tally-v-2",
  storageBucket: "tally-v-2.appspot.com",
  messagingSenderId: "193194015446",
  appId: "1:193194015446:web:41f010ef36a74df776a777"
});

const db = firebase.database();
let grades = {};

const homeEl = document.getElementById("home");
const viewEl = document.getElementById("view");
const gradeLinksEl = document.getElementById("grade-links");

db.ref("grades").on("value", snap => {
  grades = snap.val() || {};
  renderHome();
});

function renderHome() {
  viewEl.innerHTML = "";
  homeEl.style.display = "block";
  gradeLinksEl.innerHTML = "";

  for (const grade in grades) {
    const li = document.createElement("li");
    const btn = document.createElement("button");
    btn.className = "link-btn";
    btn.textContent = grade;
    btn.onclick = () => openGrade(grade);
    li.appendChild(btn);
    gradeLinksEl.appendChild(li);
  }
}

function openGrade(grade) {
  homeEl.style.display = "none";
  viewEl.innerHTML = `
    <button class="back-btn" onclick="renderHome()">‚Üê ÎèåÏïÑÍ∞ÄÍ∏∞</button>
    <h2>${grade} Ï†êÏàò</h2>
  `;
}

/* üéâ Confetti every ~10 seconds */
setInterval(() => {
  const count = 18 + Math.floor(Math.random() * 10);
  for (let i = 0; i < count; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.textContent = ["üéâ","‚ú®","‚≠ê","üíé"][Math.floor(Math.random()*4)];
    c.style.left = Math.random() * 100 + "vw";
    c.style.animationDelay = (Math.random() * 0.5) + "s";
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 4500);
  }
}, 10000);

/* üí© Random peeking poo */
function spawnPoo() {
  const p = document.createElement("div");
  p.className = "poo";
  p.textContent = "üí©";

  const side = ["left","right","top","bottom"][Math.floor(Math.random()*4)];

  if (side === "left") {
    p.style.left = "0";
    p.style.top = Math.random()*70 + 10 + "vh";
    p.style.animationName = "peekLeft";
  }
  if (side === "right") {
    p.style.right = "0";
    p.style.top = Math.random()*70 + 10 + "vh";
    p.style.animationName = "peekRight";
  }
  if (side === "top") {
    p.style.top = "0";
    p.style.left = Math.random()*70 + 10 + "vw";
    p.style.animationName = "peekTop";
  }
  if (side === "bottom") {
    p.style.bottom = "0";
    p.style.left = Math.random()*70 + 10 + "vw";
    p.style.animationName = "peekBottom";
  }

  document.body.appendChild(p);
  setTimeout(() => p.remove(), 3600);
}

setInterval(spawnPoo, 4000 + Math.random()*5000);
</script>

</body>
</html>
