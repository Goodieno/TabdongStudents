<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Class Scoreboard</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(#0a2342, #000);
    color: white;
    overflow-x: hidden;
  }

  h1 {
    text-align: center;
    margin: 20px 0;
  }

  .grade {
    margin: 20px;
    padding: 15px;
    border-radius: 12px;
    background: rgba(0,0,0,0.4);
  }

  .rank {
    font-size: 1.3em;
    margin: 8px 0;
  }

  .gold { color: gold; text-shadow: 1px 1px 2px black; }
  .silver { color: silver; text-shadow: 1px 1px 2px black; }
  .bronze { color: #cd7f32; text-shadow: 1px 1px 2px black; }

  canvas {
    position: fixed;
    top: 0;
    left: 0;
    pointer-events: none;
  }
</style>
</head>

<body>
<h1>üèÜ Class Rankings</h1>
<div id="content"></div>

<canvas id="snow"></canvas>

<script>
/* üî• FIREBASE CONFIG ‚Äî SAME AS TEACHER PAGE */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* üèÜ RENDER STUDENT VIEW */
function render(data) {
  const container = document.getElementById("content");
  container.innerHTML = "";

  if (!data) return;

  Object.keys(data).forEach(grade => {
    const classes = data[grade];
    const scored = Object.entries(classes)
      .map(([name, d]) => ({
        name,
        points: d.points || 0
      }))
      .filter(c => c.points > 0)
      .sort((a,b)=>b.points-a.points);

    if (!scored.length) return;

    const groups = {};
    scored.forEach(c=>{
      groups[c.points] = groups[c.points] || [];
      groups[c.points].push(c.name);
    });

    const div = document.createElement("div");
    div.className = "grade";
    div.innerHTML = `<h2>${grade}</h2>`;

    Object.keys(groups)
      .map(Number)
      .sort((a,b)=>b-a)     // ‚úÖ FIXED: highest score first
      .slice(0,3)
      .forEach((score,i)=>{
        const rank = i+1;
        const cls = rank===1?"gold":rank===2?"silver":"bronze";
        div.innerHTML += `
          <div class="rank ${cls}">
            ${rank}ÏúÑ (${score}Ï†ê): ${groups[score].join(", ")}
          </div>
        `;
      });

    container.appendChild(div);
  });
}

/* üîÑ REALTIME UPDATE */
firebase.database().ref("scores").on("value", snap=>{
  render(snap.val());
});

/* ‚ùÑÔ∏è SNOW ANIMATION */
const canvas = document.getElementById("snow");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const flakes = Array.from({length:120},()=>({
  x: Math.random()*canvas.width,
  y: Math.random()*canvas.height,
  r: Math.random()*3+1,
  s: Math.random()*1+0.5
}));

function snow() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "white";
  ctx.beginPath();
  flakes.forEach(f=>{
    ctx.moveTo(f.x,f.y);
    ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
  });
  ctx.fill();

  flakes.forEach(f=>{
    f.y += f.s;
    if(f.y > canvas.height) {
      f.y = -5;
      f.x = Math.random()*canvas.width;
    }
  });

  requestAnimationFrame(snow);
}
snow();

window.onresize = ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};
</script>
</body>
</html>
