<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í•™ê¸‰ ì ìˆ˜íŒ (í•™ìƒìš©)</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f9fafb; }
h1,h2{margin-bottom:16px;}
ul{list-style:none;padding:0;}
li{margin:10px 0;}
button.link-btn{background:none;border:none;color:#2563eb;font-size:18px;cursor:pointer;padding:0;}
button.link-btn:hover{text-decoration:underline;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;}
.card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:12px;}
.class-name{font-weight:bold;color:#2563eb;}
.points{float:right;font-weight:bold;}
.reasons{margin-top:10px;font-size:14px;}
.reason{border-bottom:1px dashed #ccc;padding:6px 0;}
.reason:last-child{border-bottom:none;}
.badge{margin-left:6px;font-weight:bold;}
.gold{color:#d97706;}
.silver{color:#6b7280;}
.bronze{color:#92400e;}
</style>
</head>

<body>

<div id="home">
  <h1>í•™ë…„ ì„ íƒ</h1>
  <ul id="grade-list"></ul>
</div>

<div id="view"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAfFbHdfoXoOLw7rD-nd8HPSaZR6OBBYf8",
  authDomain: "tally-v-2.firebaseapp.com",
  databaseURL: "https://tally-v-2-default-rtdb.firebaseio.com",
  projectId: "tally-v-2",
  storageBucket: "tally-v-2.appspot.com",
  messagingSenderId: "193194015446",
  appId: "1:193194015446:web:41f010ef36a74df776a777"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let grades = {};

db.ref("grades").on("value", snap => {
  grades = snap.val() || {};
  renderHome();
});

/* ===== HOME (GRADES + LEADERS) ===== */
function renderHome() {
  document.getElementById("view").innerHTML = "";
  document.getElementById("home").style.display = "block";

  const ul = document.getElementById("grade-list");
  ul.innerHTML = "";

  for (const gradeName in grades) {
    const classes = Object.entries(grades[gradeName]);
    const sorted = [...classes].sort((a,b)=>(b[1].points||0)-(a[1].points||0));

    let badges = "";
    sorted.slice(0,3).forEach((c,i)=>{
      const medal = i===0?"ğŸ¥‡":i===1?"ğŸ¥ˆ":"ğŸ¥‰";
      badges += `<span class="badge">${medal}${c[0]}</span>`;
    });

    const li = document.createElement("li");
    li.innerHTML = `<button class="link-btn" data-grade="${gradeName}">${gradeName}</button> ${badges}`;
    ul.appendChild(li);
  }
}

/* ===== GRADE VIEW ===== */
function renderGrade(gradeName) {
  document.getElementById("home").style.display = "none";

  const view = document.getElementById("view");
  view.innerHTML = `
    <button class="link-btn" id="back">â† ëŒì•„ê°€ê¸°</button>
    <h2>${gradeName}</h2>
    <div class="grid"></div>
  `;

  const grid = view.querySelector(".grid");

  for (const className in grades[gradeName]) {
    const c = grades[gradeName][className];

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div>
        <span class="class-name">${className}</span>
        <span class="points">${c.points || 0}ì </span>
      </div>
      <div class="reasons"></div>
    `;

    const reasonsDiv = card.querySelector(".reasons");
    (c.reasons || []).slice().reverse().forEach(r=>{
      const d = document.createElement("div");
      d.className = "reason";
      d.textContent = `${r.text} (${r.time})`;
      reasonsDiv.appendChild(d);
    });

    grid.appendChild(card);
  }
}

document.addEventListener("click", e=>{
  if (e.target.dataset.grade) renderGrade(e.target.dataset.grade);
  if (e.target.id==="back") renderHome();
});
</script>

</body>
</html>
